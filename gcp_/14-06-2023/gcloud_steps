
export NAME=webuser
export PROJECT_ID=projectid
gcloud projects create ${PROJECT_ID} --set-as-default

gcloud config set project $PROJECT_ID
gcloud iam service-accounts create ${NAME}

gcloud projects add-iam-policy-binding ${PROJECT_ID} \
    --member "serviceAccount:${NAME}@${PROJECT_ID}.iam.gserviceaccount.com" \
    --role "roles/owner"
touch credentials.json
gcloud iam service-accounts keys create credentials.json \
    --iam-account "${NAME}@${PROJECT_ID}.iam.gserviceaccount.com"

    export GOOGLE_APPLICATION_CREDENTIALS=$(pwd)/credentials.json

 nome database = (default)

 https://docs.cloud.google.com/python/docs/reference/firestore/latest/google.cloud.firestore_v1.document.DocumentReference

 gcloud services enable appengine.googleapis.com cloudbuild.googleapis.com storage.googleapis.com

 gcloud app create

 gcloud app deploy


 gcloud projects list


-----PUBSUB----------------------


# Pubsub
Aggiungi `google-cloud-pubsub` a requirements.txt

## Setup
### Crea progetto e credenziali
Vedi firestore.  
Dovrai usare le credenziali in ogni applicazione che faccia uso di PubSub!

### Crea un topic
```sh
export TOPIC=topic
gcloud pubsub topics create ${TOPIC}
```
### Crea una subscription a un topic
```sh
export SUBSCRIPTION_NAME=subscription_name
gcloud pubsub subscriptions create ${SUBSCRIPTION_NAME} --topic ${TOPIC}
```

## Python publisher
### Definisci il publisher
```python
from google.cloud import pubsub

publisher = pubsub.PublisherClient()
topic = 'topic'
project_id = 'project-id'
topic_path = publisher.topic_path(project_id, topic)
# puoi ottenere questo percorso anche dalla dashboard Google
```

### Pubblica un messaggio
```python
publisher.publish(topic_path, 'message'.encode('utf-8'))
# puoi usare json.dumps per inviare oggetti
```

## Python subscriber
### Definisci il subscriber
```python
from google.cloud import pubsub

subscriber = pubsub.SubscriberClient()
project_id = 'project-id'
subscription_name = 'subscription-name'
subscription_path = subscriber.subscription_path(project_id, subscription_name)
# puoi ottenere questo percorso anche dalla dashboard Google
```
### Sottoscrivi un topic
```python
pull = subscriber.subscribe(subscription_path, callback=callback)
```

### Pulla messaggi
```python
try:
    pull.result(timeout=30)
except:
    pull.cancel()
```

### Definisci un callback che sar√† invocato ad ogni ricezione di messaggio
```python
def callback(message):
    message.ack()
    message_content = message.data.decode('utf-8')
```

gcloud pubsub subscriptions describe subscription_consumi